<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">

    <title>INFINITY</title>
  </head>
  <body>
    <div class="container-fluid">

<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   id="svg8"
   version="1.1"
   viewBox="0 0 202 100"
   height="300"
   width="100%">
  <defs
     id="defs2" />
  <g
     transform="translate(0,-197)"
     id="layer1">
    <path
       id="path1960"
       d="m 50.365372,197.58493 c -13.200092,0 -25.610925,5.15785 -34.921899,14.48026 -9.3452448,9.33381 -14.49420462,21.7342 -14.49420462,34.94567 0,13.17721 5.13700702,25.60102 14.48231962,34.92344 9.310992,9.33388 21.722307,14.48077 34.933784,14.48077 13.188616,0 25.611158,-5.13578 34.728112,-14.27562 L 101,266.88355 116.68948,281.9343 c 9.32242,9.33386 21.74509,14.48077 34.94515,14.48077 13.20004,0 25.59949,-5.13549 34.9219,-14.48077 9.34533,-9.31101 14.4942,-21.73367 14.4942,-34.94516 0,-13.21145 -5.13711,-25.602 -14.48231,-34.94722 -9.34525,-9.32235 -21.74517,-14.457 -34.93379,-14.457 -13.18862,0 -25.58888,5.13498 -34.72863,14.25185 l -15.91789,15.27917 -15.675516,-15.05076 h -0.0021 C 75.988256,202.72057 63.564897,197.58493 50.365372,197.58493 Z m 0,28.66801 c 5.529233,0 10.739276,2.15327 14.878679,6.28128 l 15.058512,14.47664 -15.277102,14.63631 v 0.002 c -7.830013,7.8414 -21.479238,7.84144 -29.320691,0 -3.9218,-3.9218 -6.076117,-9.13249 -6.076117,-14.65027 0,-3.23586 0.736174,-6.35057 2.133203,-9.16791 0.995069,-2.00673 2.32573,-3.86104 3.966684,-5.50199 3.898879,-3.92169 9.107598,-6.07612 14.636832,-6.07612 z m 101.267188,0.17932 c 5.37399,-0.003 10.74718,1.9524 14.66216,5.86166 3.92198,3.94478 6.07611,9.13129 6.07611,14.67197 0,5.54062 -2.16568,10.76155 -6.08748,14.68334 l -0.016,0.0139 c -7.83274,7.83872 -21.26118,8.01609 -29.50983,-0.22117 h -0.002 l -15.05903,-14.47612 15.26574,-14.64872 c 3.92072,-3.92072 9.29591,-5.88206 14.6699,-5.88491 z"
       style="fill:#ececec;" />
</svg>

      <input id="colorX" type="color">


 
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="home-tab" data-toggle="tab" href="#rainbow" role="tab">Rainbow</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="profile-tab" data-toggle="tab" href="#colorwipe" role="tab" >Pixel Wipe</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="contact-tab" data-toggle="tab" href="#letterwipe" role="tab">Letter Wipe</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="contact-tab" data-toggle="tab" href="#random" role="tab">Random</a>
        </li> 
        <li class="nav-item">
          <a class="nav-link" id="contact-tab" data-toggle="tab" href="#randomLetter" role="tab">Random Letter</a>
        </li>               
      </ul>
          <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="rainbow" role="tabpanel">
              <form>
                <br>
                <input type="number" class="form-control" id="rainbowWait" min="1" max="255" value="50">
                <small  class="form-text text-muted">Smaller wait means faster animation.</small>
                <br>
                <button type="button" class="btn btn-primary btn-block" id="rainbowStart">Start</button>
              </form>
            </div>
            <div class="tab-pane fade" id="colorwipe" role="tabpanel" >
              <form>
                <br>
                <input type="number" class="form-control" id="colorWipeWait" min="1" max="255" value="50">
                <small id="waitHelp" class="form-text text-muted">Smaller wait means faster animation.</small>
                <br>
                <div class="row">
                    <div class="col-sm-4">
                      <input id="colorWipe1" type="color"/> <br>
                      <small class="form-text text-muted">First color.</small>      
                    </div>
                    <div class="col-sm-4">
                      <input id="colorWipe2" type="color"/> <br>
                      <small class="form-text text-muted">Second color.</small>
                    </div>
                    <div class="col-sm-4">
                      <input id="colorWipe3" type="color"/> <br>
                      <small class="form-text text-muted">Third color.</small>
                    </div>
                </div>  
                <br>              
                <button type="button" class="btn btn-primary btn-block" id="colorWipeStart">Start</button>
              </form>              

            </div>
            <div class="tab-pane fade" id="letterwipe" role="tabpanel">
              <form>
                <br>
                <input type="number" class="form-control" id="letterWipeWait" min="1" max="255" value="50">
                <small class="form-text text-muted">Smaller wait means faster animation. Value (milliseconds) is multiplied by 4.</small>
                <br>
                <div class="row">
                    <div class="col-sm-4">
                      <input id="letterWipe1" type="color"/> <br>
                      <small id="waitHelp" class="form-text text-muted">First color.</small>      
                    </div>
                    <div class="col-sm-4">
                      <input id="letterWipe2" type="color"/> <br>
                      <small id="waitHelp" class="form-text text-muted">Second color.</small>
                    </div>
                    <div class="col-sm-4">
                      <input id="letterWipe3" type="color"/> <br>
                      <small id="waitHelp" class="form-text text-muted">Third color.</small>
                    </div>
                </div>  
                <br> 
                <button type="button" class="btn btn-primary btn-block" id="letterWipeStart">Start</button>
              </form>              
            </div>
            <div class="tab-pane fade" id="random" role="tabpanel">
              <form>
                <br>
                <input type="number" class="form-control" id="randomWait" min="1" max="255" value="50">
                <small class="form-text text-muted">Smaller wait means faster animation.</small>
                <br> 
                <button type="button" class="btn btn-primary btn-block" id="randomStart">Start</button>
              </form>              
            </div>  
            <div class="tab-pane fade" id="randomLetter" role="tabpanel">
              <form>
                <br>
                <input type="number" class="form-control" id="randomLetterWait" min="1" max="255" value="50">
                <small class="form-text text-muted">Smaller wait means faster animation.</small>
                <br> 
                <button type="button" class="btn btn-primary btn-block" id="randomLetterStart">Start</button>
              </form>              
            </div>                       

      </div>      

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
    <script> 
      var pathMap = {
        "X" : ['path1960']
      };

      $().ready(function() {
        console.log("ready. go change the world.");

        checkToken();

        Object.keys(pathMap).forEach(key => {
          $('#color'+key).hide();

          pathMap[key].forEach(path => {
            $('#' + path).click(() => {
              var pickerId = '#color' + key;
              $(pickerId).click();
            })
          });

          $('#color'+key).change(() => {
            var newStyle = "fill:"+$('#color'+key).val()+";fill-opacity:1;fill-rule:nonzero;stroke:none";
            pathMap[key].forEach(path => {
              $('#'+path).attr("style", newStyle);
            });

            if (localStorage.access_token)
              sendUpdate(get01ColorCommand());
            else
              console.log("No access_token!");

          });

        });

        $('#rainbowStart').click(function() {
          var command = get02RainbowCommand(parseInt($('#rainbowWait').val(), 10));
          sendUpdate(command);
        }); 

        $('#colorWipeStart').click(function() {
          var colors = ['#colorWipe1', '#colorWipe2', '#colorWipe3'].map(element => {
            return $(element).val().substring(1);
          });

          var command = get03ColorWipeCommand(parseInt($('#colorWipeWait').val(), 10), colors);
          sendUpdate(command);
        });         

        $('#letterWipeStart').click(function() {
          var colors = ['#letterWipe1', '#letterWipe2', '#letterWipe3'].map(element => {
            return $(element).val().substring(1);
          });

          var command = get04LetterWipeCommand(parseInt($('#letterWipeWait').val(), 10), colors);
          sendUpdate(command);
        }); 

        $('#randomStart').click(function() {
          var command = get05RandomCommand(parseInt($('#randomWait').val(), 10));
          sendUpdate(command);
        }); 

        $('#randomLetterStart').click(function() {
          var command = get06RandomLetterCommand(parseInt($('#randomLetterWait').val(), 10));
          sendUpdate(command);
        });                 


      });

      function sendUpdate(command)
      {
        console.log("update");
        var options = {
          api_base : "https://api.particle.io",
          device_id : "20003f000d47343432313031"
        };

        var url = options.api_base + "/v1/devices/"+options.device_id+"/mode";
        console.log("POST", url, command);
        $.ajax({
          type: "POST",
          url :  url,
          data : {
            args : command,
            access_token : localStorage.access_token
          },
          success : function (data, textStatus, jqXHR )
          {
            console.log(data);
          },
          error : function (jqXHR, textStatus, errorThrown)
          {
            console.log(errorThrown);
          }
        })
      } 

      function get01ColorCommand()
      {
        var command = "01"; //set color
        Object.keys(pathMap).forEach(key => {
          command += ($('#color'+key).val()).substring(1);
        });

        console.log("ColorCommand is: " + command);
        return command;
      }


      function get02RainbowCommand(wait)
      {
        if (wait < 0 || wait > 255)
          throw new Error("wait is out of range[0,255]");

        var wait = Number(wait).toString(16);
        wait = (wait.length == 1) ? "0" + wait : wait;
        
        var hexString = "02" + wait;
        return hexString;
      }     

      function get03ColorWipeCommand(wait, colors)
      {
        var wait = Number(wait).toString(16);
        wait = (wait.length == 1) ? "0" + wait : wait;

        var hexString = "03";
        hexString += wait;
        hexString += colors.join('');

        return hexString;
      }

      //wait is multiplied by 2 in particle photon
      function get04LetterWipeCommand(wait, colors)
      {
        var wait = Number(wait).toString(16);
        wait = (wait.length == 1) ? "0" + wait : wait;

        var hexString = "04";
        hexString += wait;
        hexString += colors.join('');

        return hexString;
      }

      function get05RandomCommand(wait)
      {
        var wait = Number(wait).toString(16);
        wait = (wait.length == 1) ? "0" + wait : wait;

        var hexString = "05";
        hexString += wait;
        return hexString;
      }  

      function get06RandomLetterCommand(wait)
      {
        var wait = Number(wait).toString(16);
        wait = (wait.length == 1) ? "0" + wait : wait;

        var hexString = "06";
        hexString += wait;
        return hexString;
      }           





      function checkToken()
      {
        if (!localStorage.access_token)
        {
          var access_token = prompt("Please enter the particle API token:", "");
          if (access_token != null)
            localStorage.access_token = access_token;
        }
        else
        {
          console.log("Access Token found!");
        }
      }


    </script>

  </body>
</html>