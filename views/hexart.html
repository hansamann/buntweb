<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">

    <title>HEXART</title>
  </head>
  <body>
    <div class="container-fluid">

<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   id="svg8"
   version="1.1"
   viewBox="0 0 200 200"
   height="400"
   width="100%">
  <defs
     id="defs2" />
  <g
     transform="translate(0,-97)"
     id="layer1">
    <g
       transform="translate(-49.999999,50.000001)"
       id="g144">
      <path
         style="fill:#808080;fill-opacity:1;"
         d="m 249.94716,105.60051 4.2e-4,82.79793 -58.54667,58.54728 -82.79793,4.2e-4 -58.547273,-58.54668 -4.24e-4,-82.79792 58.546677,-58.547258 82.79792,-4.23e-4 z"
         id="path847" />
      <path
         style="fill:#999999;fill-opacity:1;"
         d="m 192.78081,240.0028 -84.29849,6.86598 -58.426613,-58.46932 11.735808,-79.40837 72.779575,-40.81137 79.13949,28.59477 25.90577,76.46848 z"
         id="path128" />
      <path
         style="fill:#cccccc;fill-opacity:1;"
         d="m 204.90186,193.85931 -72.59474,40.65174 -71.435638,-42.41987 0.920033,-83.10009 72.779575,-40.81137 71.27646,42.63309 z"
         id="path130" />
      <path
         style="fill:#ececec;fill-opacity:1;"
         d="M 204.90186,193.85931 125.62772,218.62268 77.313082,150.5879 127.15788,84.25063 205.84755,110.81281 Z"
         id="path132" />
      <path
         style="fill:#f9f9f9;fill-opacity:1;"
         d="M 193.03508,170.34824 125.62772,218.62268 77.313082,150.5879 145.17769,102.63132 Z"
         id="path134" />
      <path
         style="fill:#ffffff;fill-opacity:1;"
         d="m 193.03508,170.34824 -82.47157,7.38163 34.61418,-75.09855 z"
         id="path136" />
    </g>
  </g>
</svg> 

      <input id="color8" type="color">
      <input id="color7" type="color">
      <input id="color6" type="color">
      <input id="color5" type="color">
      <input id="color4" type="color">
      <input id="color3" type="color">

 
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="home-tab" data-toggle="tab" href="#rainbow" role="tab">Rainbow</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="profile-tab" data-toggle="tab" href="#colorwipe" role="tab" >Pixel Wipe</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="contact-tab" data-toggle="tab" href="#letterwipe" role="tab">Letter Wipe</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="contact-tab" data-toggle="tab" href="#random" role="tab">Random</a>
        </li> 
        <li class="nav-item">
          <a class="nav-link" id="contact-tab" data-toggle="tab" href="#randomLetter" role="tab">Random Letter</a>
        </li>               
      </ul>
          <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="rainbow" role="tabpanel">
              <form>
                <br>
                <input type="number" class="form-control" id="rainbowWait" min="1" max="255" value="50">
                <small  class="form-text text-muted">Smaller wait means faster animation.</small>
                <br>
                <button type="button" class="btn btn-primary btn-block" id="rainbowStart">Start</button>
              </form>
            </div>
            <div class="tab-pane fade" id="colorwipe" role="tabpanel" >
              <form>
                <br>
                <input type="number" class="form-control" id="colorWipeWait" min="1" max="255" value="50">
                <small id="waitHelp" class="form-text text-muted">Smaller wait means faster animation.</small>
                <br>
                <div class="row">
                    <div class="col-sm-4">
                      <input id="colorWipe1" type="color"/> <br>
                      <small class="form-text text-muted">First color.</small>      
                    </div>
                    <div class="col-sm-4">
                      <input id="colorWipe2" type="color"/> <br>
                      <small class="form-text text-muted">Second color.</small>
                    </div>
                    <div class="col-sm-4">
                      <input id="colorWipe3" type="color"/> <br>
                      <small class="form-text text-muted">Third color.</small>
                    </div>
                </div>  
                <br>              
                <button type="button" class="btn btn-primary btn-block" id="colorWipeStart">Start</button>
              </form>              

            </div>
            <div class="tab-pane fade" id="letterwipe" role="tabpanel">
              <form>
                <br>
                <input type="number" class="form-control" id="letterWipeWait" min="1" max="255" value="50">
                <small class="form-text text-muted">Smaller wait means faster animation. Value (milliseconds) is multiplied by 4.</small>
                <br>
                <div class="row">
                    <div class="col-sm-4">
                      <input id="letterWipe1" type="color"/> <br>
                      <small id="waitHelp" class="form-text text-muted">First color.</small>      
                    </div>
                    <div class="col-sm-4">
                      <input id="letterWipe2" type="color"/> <br>
                      <small id="waitHelp" class="form-text text-muted">Second color.</small>
                    </div>
                    <div class="col-sm-4">
                      <input id="letterWipe3" type="color"/> <br>
                      <small id="waitHelp" class="form-text text-muted">Third color.</small>
                    </div>
                </div>  
                <br> 
                <button type="button" class="btn btn-primary btn-block" id="letterWipeStart">Start</button>
              </form>              
            </div>
            <div class="tab-pane fade" id="random" role="tabpanel">
              <form>
                <br>
                <input type="number" class="form-control" id="randomWait" min="1" max="255" value="50">
                <small class="form-text text-muted">Smaller wait means faster animation.</small>
                <br> 
                <button type="button" class="btn btn-primary btn-block" id="randomStart">Start</button>
              </form>              
            </div>  
            <div class="tab-pane fade" id="randomLetter" role="tabpanel">
              <form>
                <br>
                <input type="number" class="form-control" id="randomLetterWait" min="1" max="255" value="50">
                <small class="form-text text-muted">Smaller wait means faster animation.</small>
                <br> 
                <button type="button" class="btn btn-primary btn-block" id="randomLetterStart">Start</button>
              </form>              
            </div>                       

      </div>      

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
    <script> 
      var pathMap = {
        "8" : ['path847'],
        "7" : ['path128'],
        "6" : ['path130'],
        "5" : ['path132'],
        "4" : ['path134'],
        "3" : ['path136']
      };

      $().ready(function() {
        console.log("ready. go change the world.");

        checkToken();

        Object.keys(pathMap).forEach(key => {
          $('#color'+key).hide();

          pathMap[key].forEach(path => {
            $('#' + path).click(() => {
              var pickerId = '#color' + key;
              $(pickerId).click();
            })
          });

          $('#color'+key).change(() => {
            var newStyle = "fill:"+$('#color'+key).val()+";fill-opacity:1;fill-rule:nonzero;stroke:none";
            pathMap[key].forEach(path => {
              $('#'+path).attr("style", newStyle);
            });

            if (localStorage.access_token)
              sendUpdate(get01ColorCommand());
            else
              console.log("No access_token!");

          });

        });

        $('#rainbowStart').click(function() {
          var command = get02RainbowCommand(parseInt($('#rainbowWait').val(), 10));
          sendUpdate(command);
        }); 

        $('#colorWipeStart').click(function() {
          var colors = ['#colorWipe1', '#colorWipe2', '#colorWipe3'].map(element => {
            return $(element).val().substring(1);
          });

          var command = get03ColorWipeCommand(parseInt($('#colorWipeWait').val(), 10), colors);
          sendUpdate(command);
        });         

        $('#letterWipeStart').click(function() {
          var colors = ['#letterWipe1', '#letterWipe2', '#letterWipe3'].map(element => {
            return $(element).val().substring(1);
          });

          var command = get04LetterWipeCommand(parseInt($('#letterWipeWait').val(), 10), colors);
          sendUpdate(command);
        }); 

        $('#randomStart').click(function() {
          var command = get05RandomCommand(parseInt($('#randomWait').val(), 10));
          sendUpdate(command);
        }); 

        $('#randomLetterStart').click(function() {
          var command = get06RandomLetterCommand(parseInt($('#randomLetterWait').val(), 10));
          sendUpdate(command);
        });                 


      });

      function sendUpdate(command)
      {
        console.log("update");
        var options = {
          api_base : "https://api.particle.io",
          device_id : "420036000347343138333038"
        };

        var url = options.api_base + "/v1/devices/"+options.device_id+"/mode";
        console.log("POST", url, command);
        $.ajax({
          type: "POST",
          url :  url,
          data : {
            args : command,
            access_token : localStorage.access_token
          },
          success : function (data, textStatus, jqXHR )
          {
            console.log(data);
          },
          error : function (jqXHR, textStatus, errorThrown)
          {
            console.log(errorThrown);
          }
        })
      } 

      function get01ColorCommand()
      {
        var command = "01"; //set color
        Object.keys(pathMap).forEach(key => {
          command += ($('#color'+key).val()).substring(1);
        });

        console.log("ColorCommand is: " + command);
        return command;
      }


      function get02RainbowCommand(wait)
      {
        if (wait < 0 || wait > 255)
          throw new Error("wait is out of range[0,255]");

        var wait = Number(wait).toString(16);
        wait = (wait.length == 1) ? "0" + wait : wait;
        
        var hexString = "02" + wait;
        return hexString;
      }     

      function get03ColorWipeCommand(wait, colors)
      {
        var wait = Number(wait).toString(16);
        wait = (wait.length == 1) ? "0" + wait : wait;

        var hexString = "03";
        hexString += wait;
        hexString += colors.join('');

        return hexString;
      }

      //wait is multiplied by 2 in particle photon
      function get04LetterWipeCommand(wait, colors)
      {
        var wait = Number(wait).toString(16);
        wait = (wait.length == 1) ? "0" + wait : wait;

        var hexString = "04";
        hexString += wait;
        hexString += colors.join('');

        return hexString;
      }

      function get05RandomCommand(wait)
      {
        var wait = Number(wait).toString(16);
        wait = (wait.length == 1) ? "0" + wait : wait;

        var hexString = "05";
        hexString += wait;
        return hexString;
      }  

      function get06RandomLetterCommand(wait)
      {
        var wait = Number(wait).toString(16);
        wait = (wait.length == 1) ? "0" + wait : wait;

        var hexString = "06";
        hexString += wait;
        return hexString;
      }           





      function checkToken()
      {
        if (!localStorage.access_token)
        {
          var access_token = prompt("Please enter the particle API token:", "");
          if (access_token != null)
            localStorage.access_token = access_token;
        }
        else
        {
          console.log("Access Token found!");
        }
      }


    </script>

  </body>
</html>